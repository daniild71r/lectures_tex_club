% Про необходимое условие теоремы
\begin{example}
	Требование непрерывности частных производных существенно. Это показывает следующая функция:
	\[
		f(x, y) = \sqrt{|xy|}
	\]
	Покажем, что у этой непрерывной в нуле функции есть частные производные в этой же точке, но при этом они разрывны и сама функция не дифференцируема. Начнём с частных производных:
	\[
		\pd{f}{x}(0, 0) = \liml_{\Delta x \to 0} \frac{f(\Delta x, 0) - f(0, 0)}{\Delta x} = 0 = \pd{f}{y}(0, 0)
	\]
	Сами функции частных производных имеют вид
	\[
		\pd{f}{x}(x, y) = \sqrt{|y|} \cdot \frac{1}{2\sqrt{|x|}} \cdot \sgn{x} \xrightarrow[x \to 0]{} \infty
	\]
	Значит, у нас присутствует разрыв частных производных в нуле.
\end{example}

\begin{example}
	Теорема в обратную сторону, вообще говоря, неверна. Рассмотрим функцию $f(x, y)$ следующего вида:
	\[
		f(x, y) = \sqrt[3]{x^2 y^2}
	\]
	Частные производные в точке $(0, 0)$, очевидно, равны нулю и при этом выполнено следующее:
	\[
		\Delta f(0, 0) = \sqrt[3]{(\Delta x)^2 (\Delta y)^2} = r^{4/3} \sqrt[3]{\cos^2 \phi \sin^2 \phi} \le r^{4/3}
	\]
	То есть $\Delta f = o(r),\ r \to 0$. Таким образом функция дифференцируема, хоть ее частные производные в нуле не непрерывны. Таким образом мы показали отсутствие необходимости условий теоремы для дифференцируемости.
\end{example}

\begin{theorem} (Дифференцируемость сложной функции)
	Пусть $f$ дифференцируема в точке $\vv{y}_0 \in \R^m$, $\forall j \in \range{m}\ g_j$ дифференцируема в точке $\vv{x}_0 \in \R^n$, причём $g_j(\vv{x}_0) = y_{j, 0}$, если $\vv{y}_0 = (y_{1, 0}, \ldots, y_{m, 0})$. Тогда сложная функция $h(\vv{x}) = f(g_1(\vv{x}), \ldots, g_m(\vv{x}))$ дифференцируема в точке $\vv{x}_0$, причём
	\[
		\grad h(\vv{x}_0) = \grad f(\vv{y}_0)
	\]
\end{theorem}

\begin{proof}
	Чтобы доказать дифференцируемость функции $h$, нужно расписать её приращение:
	\[
		\Delta h(\vv{x}_0) = f(g_1(\vv{x}_0 + \vv{\Delta x}), \ldots, g_m(\vv{x}_0 + \vv{\Delta x})) - f(g_1(\vv{x}_0), \ldots, g_m(\vv{x}_0))
	\]
	Положим по определению $\Delta y_j := g_j(\vv{x}_0 + \vv{\Delta x}) - g_j(\vv{x}_0)$. Тогда
	\[
		\forall j \in \range{m}\ g_j(\vv{x}_0 + \vv{\Delta x}) = y_{j, 0} + \Delta y_j
	\]
	То есть приращение можно переписать в другом виде
	\[
		\Delta h(\vv{x}_0) = f(\vv{y}_0 + \vv{\Delta y}) - f(\vv{y}_0) = \frac{\vdelta f}{\vdelta y_1} (\vv{y}_0) \Delta y_1 + \ldots + \frac{\vdelta f}{\vdelta y_m} (\vv{y}_0) \Delta y_m + o(|\vv{\Delta y}|), |\Delta y| \to 0
	\]
	Продолжим цепочку преобразований приращения:
	\begin{multline*}
		\Delta h(\vv{x}_0) = \suml_{j = 1}^m \pd{f}{y_j}(\vv{y}_0) (g_j(\vv{x}_0 + \vv{\Delta x}) - g_j(\vv{x}_0)) + o(|\vv{\Delta y}|) =
		\\
		\suml_{j = 1}^m \frac{\vdelta f}{\vdelta y_j} (\vv{y}_0) \left(\suml_{k = 1}^n \frac{\vdelta g_j}{\vdelta x_k} (\vv{x}_0) \Delta x_k + o_j(|\vv{\Delta x}|)\right) + o(|\vv{\Delta y}|) =
		\\
		\suml_{k = 1}^n \left(\suml_{j = 1}^m \frac{\vdelta f}{\vdelta y_i} (\vv{y}_0) \cdot \frac{\vdelta g_j}{\vdelta x_k} (\vv{x}_0)\right) \Delta x_k + \suml_{j = 1}^m \frac{\vdelta f}{\vdelta y_i} (\vv{y}_0) \cdot o_j(|\vv{\Delta x}|) + o(|\vv{\Delta y}|)
	\end{multline*}
	Если мы докажем, что вторая сумма - это $o(|\vv{\Delta x}|)$, то теорема будет доказана. Если $|\vv{\Delta y}| \neq 0$, то запишем о-малое в следующем виде:
	\[
		o(|\vv{\Delta y}|) = \frac{o(|\vv{\Delta y}|)}{|\vv{\Delta y}|} \cdot \frac{|\vv{\Delta y}|}{|\vv{\Delta x}|}
	\]
\end{proof}

\begin{corollary}
	Сумма, разность и произведение функций многих переменных - дифференцируема в точке $\vv{x}_0$, если изначальные функции тоже были дифференцируемы в точке $\vv{x}_0$
\end{corollary}

\begin{corollary} (Инвариантность формы первого дифференциала)
	Пусть $f$ дифференцируема в точке $\vv{y}_0$. Тогда формула
	\[
		df(\vv{y}_0) = \suml_{j = 1}^m \frac{\vdelta f}{\vdelta y_j} (\vv{y}_0) dy_j
	\]
	справедлива как в случае, когда $y_1, \ldots, y_m$ - независимые переменные, то и в случае, когда они являются дифференцируемыми функциями от $x_1, \ldots, x_n$
\end{corollary}

\begin{proof}
	Пусть $f$ зависит от $y_j = g_j(x_1, \ldots, x_n)$. Тогда $dh(\vv{x}_0)$, где $h = f(g_1, \ldots, g_m)$, имеет вид
	\[
		dh(\vv{x}_0) = \suml_{k = 1}^n \frac{\vdelta h}{\vdelta x_k} (\vv{x}_0) dx_k = \suml_{k = 1}^n \left(\suml_{j = 1}^m \frac{\vdelta f}{\vdelta y_j} (\vv{y}_0) \frac{\vdelta g_j}{\vdelta x_k} (\vv{x}_0)\right) dx_k =
		\\
		\suml_{j = 1}^m \frac{\vdelta f}{\vdelta y_j} (\vv{y}_0) \underbrace{\left(\suml_{k = 1}^n \frac{\vdelta g_j}{\vdelta x_k} (\vv{x}_0) dx_k\right)}_{dy_j}
	\]
\end{proof}

\subsection{Геометрический смысл градиента и дифференцируемости}

\begin{definition}
	\textit{Область} - это открытое связное множество. \textit{Замкнутая область} - это замыкание области.
\end{definition}

\begin{definition}
	\textit{Параметрически заданной поверхностью} в $\R^3$ называется множество точек $(x, y, z) \in \R^3$, задаваемых непрерывными в некоторой замкнутой области $\vv{D} \subset \R^2$ функциями
	\begin{align*}
		&{x = \phi(u, v)}
		\\
		&{y = \psi(u, v)}
		\\
		&{z = \chi(u, v)}
	\end{align*}
	В частности, график функции $z = f(x, y)$, где $(x, y) \in \vv{D}$.
\end{definition}

\begin{definition}
	Плоскость, проходящая через точку $M_0(x_0, y_0, f(x_0, y_0))$, называется \textit{касательной плоскостью} к графику $z = f(x, y)$ в данной точке, если для $M_1(x, y, f(x, y))$ угол между секущей $M_0 M_1$ и плоскостью стремится к нулю при $(x, y) \to (x_0, y_0)$ в $\vv{D}$.
\end{definition}

% Здесь нужна картинка с осями и плоскостями. Пнуть меня для фото

\begin{theorem}
	Если $f(x, y)$ дифференцируема в точке $(x_0, y_0)$, то касательная плоскость к $z = f(x, y)$ в точке $M_0(x_0, y_0, f(x_0, y_0))$ существует и задаётся уравнением
	\[
		z - f(x_0, y_0) = \pd{f}{x} (x_0, y_0) (x - x_0) + \pd{f}{y} (x_0, y_0) (y - y_0)
	\]
\end{theorem}

\begin{proof}
	Выберем точку $M_1(x, y, f(x, y))$. Из дифференцируемости следует, что $f$ определена в некоторой окрестности точки $(x_0, y_0)$. Стало быть, $M_1$ в окрестности тоже определена. Запишем уравнение секущей $M_0 M_1$:
	\[
		\frac{X - x_0}{x - x_0} = \frac{Y - y_0}{y - y_0} = \frac{Z - f(x_0, y_0)}{f(x, y) - f(x_0, y_0)}
	\]
	где $(X, Y, Z)$ - точка на прямой. Из данного уравнения мы можем узнать направляющий вектор прямой $M_0 M_1$:
	\[
		\vv{a} \leftrightarrow (x - x_0, y - y_0, f(x, y) - f(x_0, y_0))
	\]
	Нормальный вектор $\vv{n}$ к плоскости, заданной уравнением в теореме, имеет вид
	\[
		\vv{n} \leftrightarrow \left(\pd{f}{x} (x_0, y_0), \pd{f}{y} (x_0, y_0), -1\right)
	\]
	Теперь посмотрим на косинус угла между $\vv{a}$ и $\vv{n}$:
	\[
		\cos \angle (\vv{a}, \vv{n}) = \frac{\pd{f}{x} (x_0, y_0)(x - x_0) + \pd{f}{y} (x_0, y_0)(y - y_0) - f(x, y) + f(x_0, y_0)}{|\vv{a}|\cdot |\vv{n}|}
	\]
	Также распишем приращение функции в $(x_0, y_0)$:
	\[
		z - f(x_0, y_0) = \frac{\vdelta f}{\vdelta x}(x_0, y_0)(x - x_0) + \frac{\vdelta f}{\vdelta y}(x_0, y_0)(y - y_0) + o\big(|(x - x_0, y - y_0)|\big)
	\]
	Итого получаем:
	\[
		|\cos \angle (\vv{a}, \vv{n})| = \frac{|o(x - x_0, y - y_0)|}{|\vv{a}|\cdot |\vv{n}|} \leq \frac{|o(x - x_0, y - y_0)|}{\sqrt{1} \cdot \sqrt{(x - x_0)^2 + (y - y_0)^2}} \xrightarrow[(x, y) \to (x_0, y_0)]{} 0
	\]
	Так как косинус стремится к 0, то $\vv{n}$ и правда нормаль к поверхности в окрестности.
\end{proof}

\begin{definition}
	\textit{Производной функции $f$ в точке $\vv{x}_0$ по направлению} $\vv{l}$ называется предел (если он существует):
	\[
		\pd{f}{\vv{l}} (\vv{x}_0) := \liml_{t \to 0+} \frac{f(\vv{x}_0 + t\vv{l}) - f(\vv{x}_0)}{t}
	\]
\end{definition}

\begin{note}
	В разных книгах производную по направлению определяют по-разному. Например, могут убрать стремление $t$ к 0 лишь с положительной стороны, могут добавить модуль $\vv{l}$ в знаменатель или потребовать, что $\vv{l}$ имеет единичную длину. Поэтому, если нужно прочитать доказательство, использующее производную по направлению, то стоит уточнить, что именно под этим понятием подразумевает автор.
\end{note}

\begin{proposition}
	Если $f$ дифференцируема в $\vv{x}_0$, то она имеет производную по любому направлению $\vv{l} \neq \vv{0}$, причём
	\[
		\pd{f}{\vv{l}} (\vv{x}_0) = \trbr{\grad f(\vv{x}_0), \vv{l}}
	\]
\end{proposition}

\begin{proof}
	Распишем дробь под пределом:
	\begin{multline*}
		\pd{f}{\vv{l}}(\vv{x}_0) = \liml_{t \to 0^+}\frac{f(\vv{x}_0 + t\vv{l}) - f(\vv{x}_0)}{t} = \frac{\trbr{\grad f(\vv{x}_0), t\vv{l}} + o(|t\vv{l}|)}{t} = \\
		= \liml_{t \to 0^+} \left(\trbr{\grad f(\vv{x}_0), \vv{l}} + |\vv{l}| \cdot \frac{o(t)}{t}\right) = \trbr{\grad f(\vv{x}_0), \vv{l}}
	\end{multline*}
\end{proof}

\begin{corollary}
	Если $f$ дифференцируема в точке $\vv{x}_0$ и $\grad f(\vv{x}_0) \neq \vv{0}$, то производная по направлению $\vv{l},\ |\vv{l}| = 1$
	\begin{itemize}
		\item Максимальна при $\vv{l} = \frac{\grad f(\vv{x}_0)}{|\grad f(\vv{x}_0)|}$
		
		\item Минимальна при $\vv{l} = -\frac{\grad f(\vv{x}_0)}{|\grad f(\vv{x}_0)|}$
	\end{itemize}
\end{corollary}

\begin{note}
	То есть по сути данное следствие указывает, что изменение функции максимально по направлению градиента в данной точке и минимально в обратную сторону.
\end{note}

\begin{proof}
	Распишем модуль производной по направлению как скалярное произведение:
	\[
		\left|\pd{f}{\vv{l}} (\vv{x}_0)\right| = \left|\trbr{\grad f(\vv{x}_0), \vv{l}}\right| \le |\grad f(\vv{x}_0)|
	\]
	Последнее неравенство - это неравенство Коши-Буняковского-Шварца. Равенство достицается, если
	\[
		\vv{l} = \pm \frac{\grad f(\vv{x}_0)}{|\grad f(\vv{x}_0)|}
	\]
\end{proof}